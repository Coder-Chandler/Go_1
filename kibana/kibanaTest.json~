# es文档 ，索引的CRUD操作

# 索引初始化操作 
# 指定分片和副本的数量 
# shards一旦设置不能修改 
PUT lagou
{
  "settings": {
    "index": {
      "number_of_shards": 5,
      "number_of_replicas": 1
    }
  }
}

GET lagou/_settings
GET _all/_settings
GET .kibana,lagou/_settings
GET _settings

# 修改settings
PUT lagou/_settings
{
  "number_of_replicas": 2
}

# 获取索引信息 
GET _all
GET lagou

# 保存文档 
PUT lagou/job/1
{
  "title": "python scrapy enginer",
  "salary_min": 25000,
  "city": "ShangHai",
  "company":{
    "name": "bilibili",
    "company_addr": "ShangHai nanjing road"
  },
  "publish_date": "2017-11-18",
  "comments": 20
}

GET lagou/job/1

GET lagou/job/1?_source=title,city
GET lagou/job/1?_source

# 修改文档 
PUT lagou/job/1
{
  "title": "python scrapy enginer",
  "salary_min": 25000,
  "city": "ShangHai",
  "company":{
    "name": "bilibili",
    "company_addr": "ShangHai nanjing road"
  },
  "publish_date": "2017-11-18"
}

POST lagou/job/1/_update
{
  "doc": {
    "salary_min": 30000
  }
}

# 删除 
DELETE lagou/job/1
DELETE lagou/job
DELETElagou

####################################

PUT testdb
{
  "settings": {
    "index": {
      "number_of_shards": 5,
      "number_of_replicas": 1
    }
  }
}

PUT testdb/job1/1
{
  "title": "job1_1"
}

PUT testdb/job1/2
{
  "title": "job1_2"
}


PUT testdb/job2/1
{
  "title": "job2_1"
}

PUT testdb/job2/2
{
  "title": "job2_2"
}

# 获取job1下id为1和job2下id为2的信息
GET _mget
{
  "docs":[
    {
      "_index":"testdb",
      "_type":"job1",
      "_id":1
    },
    {
      "_index":"testdb",
      "_type":"job2",
      "_id":2
    }
    ]
}

# 获取job1下id为1和job2下id为2的信息
GET testdb/_mget
{
  "docs":[
    {
      "_type":"job1",
      "_id":1
    },
    {
      "_type":"job2",
      "_id":2
    }
    ]
}

# 获取job1下id为1和id为2的信息
GET testdb/job1/_mget
{
  "docs":[
    {
      "_id":1
    },
    {
      "_id":2
    }
    ]
}

# 获取job1下id为1和id为2的信息（前提同一个title下的id）
GET testdb/job1/_mget
{
  "ids":[1,2]
}

# 批量操作
POST _bulk
{"index":{"_index":"lagou","_type":"job1","_id":"1"}}
{"title":"python spider","salary_min":20000,"city":"ShangHai","company":{"name":"BiliBili","company_addr":"ShangHai nanjing road"},"public_date":"2017-11-18","comments":"20"}
{"index":{"_index":"lagou","_type":"job2","_id":"2"}}
{"title":"python Django","salary_min":18000,"city":"ShangHai","company":{"name":"AcFun","company_addr":"ShangHai nanjing road"},"public_date":"2017-11-16","comments":"33"}


#########################################
# 创建索引
PUT lagou
{
  "mappings": {
    "job": {
      "properties": {
        "title": {
          "type":"text"
        },
        "salary_min": {
          "type":"integer"
        },
        "city": {
          "type":"keyword"
        },
        "company": {
          "properties": {
            "name": {
              "type":"text"
            },
            "company_addr": {
              "type":"text"
            },
            "employee_count": {
              "type":"integer"
            }
          }
        },
        "public_date": {
          "type":"date",
          "format":"yyyy-MM-dd"
        },
        "comments": {
          "type":"integer"
        }
      }
    }
  }
}
# 放入数据
PUT lagou/job/2
{
  "title": "python scrapy enginer",
  "salary_min": 25000,
  "city": "ShangHai",
  "company":{
    "name": "bilibili",
    "company_addr": "ShangHai nanjing road",
    "employee_count":50
  },
  "publish_date": "2017-11-18",
  "comments": 20
}

GET lagou/_mapping/job
GET _all/_mapping/job

################################################
PUT lagou
{
  "mappings": {
    "job": {
      "properties": {
        "title": {
          "store": true, 
          "type":"text",
          "analyzer": "ik_max_word"
        },
        "company_name": {
          "store": true,
          "type":"keyword"
        },
        "desc": {
          "type":"text"
        },
        "comments": {
          "type":"integer"
        },
        "add_time": {
          "type":"date",
          "format":"yyyy-MM-dd"
        }
      }
    }
  }
}

POST lagou/job/
{
  "title": "python scrapy enginer",
  "company_name": "微软亚洲研究院",
  "desc": "熟悉django，熟悉python，熟悉scrapy框架",
  "comments":20,
  "add_time":"2017-11-18"
}
POST lagou/job/
{
  "title": "python Django前端工程师",
  "company_name": "谷歌",
  "desc": "熟悉django，对前端基础知识非常熟悉",
  "comments":29,
  "add_time":"2017-11-17"
}

POST lagou/job/
{
  "title": "python机器学习",
  "company_name": "instagram",
  "desc": "熟练掌握python基础知识，了解大数据，分布式",
  "comments":20,
  "add_time":"2017-11-18"
}


# match查
GET lagou/_search
{
  "query": {
    "match": {
      "title":"django"
    }
  }
}

# item查询
GET lagou/_search
{
  "query": {
    "item": {
      "company":"微软"
    }
  }
}

